{"version":3,"file":"main.min.js","sources":["main.min.js"],"sourcesContent":["/*\n    logger - 向右侧信息台输出信息\n    pattern - singleton\n */\nvar logger = (function(global, doc, undef) {\n    function _log(msg) {\n        if (msg) {\n            setTimeout(function(){\n                $('.logger-list').last().append('<li \"class=\"logger-list-item\"> - ' + new Date() + ': ' + msg + ' - </li>');\n            }, 500);\n        }\n    }\n    return {\n        log: _log\n    };\n}(window, document));\n\n/**\n * mediator - 中介者，负责传送指令\n */\nvar mediator = (function ( global, doc, undef ) {\n    var orbits = {},\n        subUid = -1,\n\n        subscribe = function (orbit, obj ) {\n            var token;\n\n            if (!orbits[orbit]) {\n                orbits[orbit] = [];\n            }\n\n    \t\t// add observer to observerlist(orbits)\n            token = (++subUid).toString();\n            orbits[orbit].push({\n                context: obj,\n                orbit: orbit,\n                token: token,\n                callback: obj.transferSys.messageReceiver\n            });\n\n            return token;\n        },\n        publish = function (orbit) {\n            var args,\n                len;\n\n            // undefined check\n            if (!orbits[orbit]) {\n                return false;\n            }\n\n            args = Array.prototype.slice.call(arguments);\n            len = orbits[orbit].length;\n\n            for (var i = 0;i < len;i++) {\n                var subscription = orbits[orbit][i];\n                subscription.callback.apply(subscription.context, args);\n            }\n\n            // chain pattern\n            return this;\n        },\n        unsubscribe = function (token) {\n            for (var m in orbits) {\n                if (orbits[m]) {\n                    for (var i = 0, j = orbits[m].length; i < j; i++) {\n                        if (orbits[m][i].token === token) {\n                            orbits[m].splice(i, 1);\n                            return token;\n                        }\n                    }\n                }\n            }\n            return false;\n        };\n\n        return {\n            subscribe: subscribe,\n            publish: publish,\n            unsubscribe: unsubscribe,\n        };\n}(window, document));\n\n/**\n *  spaceship  factory\n */\nvar shipFactory = (function (global, doc, undef) {\n\n    // spaceship prototype\n    function spaceship(options) {\n        var obj = {\n            orbit: options.orbit || 0,\n            isFly: false,\n            isGone: false,\n            leftEnergy: 100,\n            flySpeed: options.flySpeed || 1,\n            restoreSpeed: options.restoreSpeed || 5,\n            consumeSpeed: options.consumeSpeed || 3,\n            angle: 0,\n            // interval animation id\n            launchId: 0,\n            stopId: 0,\n\n            driveSys: {\n                launch: function () {\n                    if (obj.leftEnergy > 0) {\n                        obj.isFly = true;\n                        clearInterval(obj.launchId);\n                        clearInterval(obj.stopId);\n                        obj.launchId = setInterval(function(){\n                            obj.driveSys.fly();\n                            obj.energySys.consume();\n                        }, 200);\n                    }\n                },\n                stop: function () {\n                    obj.isFly = false;\n                    clearInterval(obj.launchId);\n                    clearInterval(obj.stopId);\n                    obj.stopId = setInterval(function(){\n                        obj.energySys.restore();\n                    }, 200);\n                },\n                fly: function () {\n                    if (obj.isFly) {\n                        obj.angle += obj.flySpeed;\n                    }\n                    obj.angle %= 360;\n                    $('#ship' + obj.orbit).css('transform', 'rotate(' + obj.angle + 'deg)');\n                }\n            },\n\n            energySys: {\n                restore: function () {\n                    if (!obj.isFly) {\n                        obj.leftEnergy += obj.restoreSpeed;\n                    }\n                    if (obj.leftEnergy > 100) {\n                        obj.leftEnergy = 100;\n                    }\n                    $('#ship' + obj.orbit).text(obj.leftEnergy + '%');\n                },\n                consume: function () {\n                    if (obj.isFly) {\n                        obj.leftEnergy -= obj.consumeSpeed;\n                    }\n                    if (obj.leftEnergy <= 0) {\n                        obj.isFly = false;\n                        obj.leftEnergy = 0;\n                        clearInterval(obj.launchId);\n                        clearInterval(obj.stopId);\n                        obj.stopId = setInterval(function(){\n                            obj.energySys.restore();\n                        }, 200);\n                    }\n                    $('#ship' + obj.orbit).text(obj.leftEnergy + '%');\n                }\n            },\n\n            destroySys: {\n                destroy: function () {\n                    obj.isGone = true;\n                    setTimeout(function () {\n                        $('#ship' + obj.orbit).remove();\n                    }, 200);\n                }\n            },\n\n            transferSys: {\n                messageReceiver: function (orbit, msg) {\n                    switch (msg.command) {\n                        case 'launch':\n                            obj.driveSys.launch();\n                            break;\n                        case 'stop':\n                            obj.driveSys.stop();\n                            break;\n                        case 'rate':\n                            obj.flySpeed = msg.flySpeed;\n                            break;\n                        case 'destroy':\n                            obj.destroySys.destroy();\n                            break;\n                    }\n                }\n            }\n        };\n\n        return obj;\n    }\n\n    function _create(options) {\n        if (typeof options === 'object') {\n            var obj = new spaceship(options);\n            //  开始监测指挥官发来的信号\n            mediator.subscribe(obj.orbit, obj);\n            setTimeout(function () {\n                $('.space').append('<button class=\"spaceship\" type=\"button\" id=\"ship' + obj.orbit + '\">100%</button>');\n            }, 200);\n            return obj;\n        }\n    }\n\n    return {\n        create: _create\n    };\n\n}(window, document));\n\n/**\n * commander - 指挥官\n */\nvar commander =  (function (global, doc, undef) {\n    var commandList = {\n        launch: {\n            id: 1,\n            command: 'launch'\n        },\n        stop: {\n            id: 2,\n            command: 'stop'\n        },\n        rate: {\n            id: 3,\n            command: 'rate',\n            flySpeed: 1,\n        },\n        destroy: {\n            id: 4,\n            command: 'destroy'\n        }\n    },\n    existShip = [false, false, false ,false];\n\n    function _getList() {\n        return commandList;\n    }\n\n    function _set(index) {\n        existShip[index] = true;\n    }\n\n    function _remove(index) {\n        existShip[index] = false;\n    }\n\n    function _get(index) {\n        return existShip[index];\n    }\n\n    function _send(orbit, msg) {\n        if(Math.random() <= 0.3) {\n            logger.log(\"向轨道\" + (orbit + 1) + \"发送的 \" + msg.command + \" 指令发生未知错误！\");\n            return false;\n        } else {\n            logger.log(\"向轨道\" + (orbit + 1) + \"成功发送 \" + msg.command + \" 指令！\");\n            mediator.publish(orbit, msg);\n            return true;\n        }\n    }\n\n    return {\n        getCommandList: _getList,\n        setState: _set,\n        removeState: _remove,\n        getState: _get,\n        sendMessage: _send\n    };\n}(window, document, undefined));\n\n(function (global, doc, undef) {\n    // 利用事件委托绑定回调\n    $('.panel-list').click(function (e) {\n        var event = e || window.event,\n            target = event.target || event.srcElement,\n            $target = $(target),\n            index = $target.parent().index(),\n            cmdList = commander.getCommandList(),\n            rateCmd = {},\n            msgState = false;\n\n        function stateCheck(index) {\n            if (!commander.getState(index)) {\n                logger.log(\"向轨道\" + (index + 1) + \"发送的 \" + $target.attr('class') + \" 指令发生未知错误！\");\n                return false;\n            } else {\n                return true;\n            }\n        }\n\n        if (target.nodeName.toLowerCase() == \"button\") {\n            switch ($target.attr('class')) {\n                case 'create':\n                    if (!commander.getState(index)) {\n                        shipFactory.create({orbit: index});\n                        commander.setState(index);\n                        logger.log((index + 1) + '号飞船创建成功');\n                    }\n                    break;\n                case 'launch':\n                    if (stateCheck(index)) {\n                        commander.sendMessage(index, cmdList.launch);\n                    }\n                    break;\n                case 'stop':\n                    if (stateCheck(index)) {\n                        commander.sendMessage(index, cmdList.stop);\n                    }\n                    break;\n                case 'rate':\n                    if (stateCheck(index)) {\n                        rateCmd = Object.create(cmdList.rate);\n                        rateCmd.flySpeed = parseInt($target.parent().children('input').val());\n                        commander.sendMessage(index, rateCmd);\n                    }\n                    break;\n                case 'destroy':\n                    if (stateCheck(index)) {\n                        msgState = commander.sendMessage(index, cmdList.destroy);\n                        if (msgState) {\n                            commander.removeState(index);\n                        }\n                    }\n                    break;\n            }\n        }\n    });\n}(window, document));\n"],"names":["window","document","logger","log","msg","setTimeout","$","last","append","Date","mediator","orbits","subUid","subscribe","orbit","obj","token","toString","push","context","callback","transferSys","messageReceiver","publish","args","Array","prototype","slice","call","arguments","len","length","i","subscription","apply","this","unsubscribe","m","j","splice","shipFactory","spaceship","options","isFly","isGone","leftEnergy","flySpeed","restoreSpeed","consumeSpeed","angle","launchId","stopId","driveSys","launch","clearInterval","setInterval","fly","energySys","consume","stop","restore","css","text","destroySys","destroy","remove","command","create","commander","commandList","id","rate","existShip","getCommandList","setState","index","removeState","getState","sendMessage","Math","random","click","e","event","target","srcElement","$target","parent","cmdList","rateCmd","stateCheck","attr","nodeName","toLowerCase","Object","parseInt","children","val"],"mappings":"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"}