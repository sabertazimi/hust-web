window,document;var logger={log:function(e){e&&setTimeout(function(){$(".logger-list").last().append('<li "class="logger-list-item"> - '+new Date+": "+e+" - </li>")},500)}},mediator=function(){var a={},r=-1;return{subscribe:function(e,t){var n;return a[e]||(a[e]=[]),n=(++r).toString(),a[e].push({context:t,orbit:e,token:n,callback:t.transferSys.messageReceiver}),n},publish:function(e){if(!a[e])return!1;for(var t=Array.prototype.slice.call(arguments),n=a[e].length,r=0;r<n;r++){var o=a[e][r];o.callback.apply(o.context,t)}return this},unsubscribe:function(e){for(var t in a)if(a[t])for(var n=0,r=a[t].length;n<r;n++)if(a[t][n].token===e)return a[t].splice(n,1),e;return!1}}}((window,document)),shipFactory=function(){function n(e){var n={orbit:e.orbit||0,isFly:!1,isGone:!1,leftEnergy:100,flySpeed:e.flySpeed||1,restoreSpeed:e.restoreSpeed||5,consumeSpeed:e.consumeSpeed||3,angle:0,launchId:0,stopId:0,driveSys:{launch:function(){0<n.leftEnergy&&(n.isFly=!0,clearInterval(n.launchId),clearInterval(n.stopId),n.launchId=setInterval(function(){n.driveSys.fly(),n.energySys.consume()},200))},stop:function(){n.isFly=!1,clearInterval(n.launchId),clearInterval(n.stopId),n.stopId=setInterval(function(){n.energySys.restore()},200)},fly:function(){n.isFly&&(n.angle+=n.flySpeed),n.angle%=360,$("#ship"+n.orbit).css("transform","rotate("+n.angle+"deg)")}},energySys:{restore:function(){n.isFly||(n.leftEnergy+=n.restoreSpeed),100<n.leftEnergy&&(n.leftEnergy=100),$("#ship"+n.orbit).text(n.leftEnergy+"%")},consume:function(){n.isFly&&(n.leftEnergy-=n.consumeSpeed),n.leftEnergy<=0&&(n.isFly=!1,n.leftEnergy=0,clearInterval(n.launchId),clearInterval(n.stopId),n.stopId=setInterval(function(){n.energySys.restore()},200)),$("#ship"+n.orbit).text(n.leftEnergy+"%")}},destroySys:{destroy:function(){n.isGone=!0,setTimeout(function(){$("#ship"+n.orbit).remove()},200)}},transferSys:{messageReceiver:function(e,t){switch(t.command){case"launch":n.driveSys.launch();break;case"stop":n.driveSys.stop();break;case"rate":n.flySpeed=t.flySpeed;break;case"destroy":n.destroySys.destroy()}}}};return n}return{create:function(e){var t;if("object"==typeof e)return t=new n(e),mediator.subscribe(t.orbit,t),setTimeout(function(){$(".space").append('<button class="spaceship" type="button" id="ship'+t.orbit+'">100%</button>')},200),t}}}((window,document)),commander=function(){var e={launch:{id:1,command:"launch"},stop:{id:2,command:"stop"},rate:{id:3,command:"rate",flySpeed:1},destroy:{id:4,command:"destroy"}},t=[!1,!1,!1,!1];return{getCommandList:function(){return e},setState:function(e){t[e]=!0},removeState:function(e){t[e]=!1},getState:function(e){return t[e]},sendMessage:function(e,t){return Math.random()<=.3?(logger.log("向轨道"+(e+1)+"发送的 "+t.command+" 指令发生未知错误！"),!1):(logger.log("向轨道"+(e+1)+"成功发送 "+t.command+" 指令！"),mediator.publish(e,t),!0)}}}((window,document));window,document,$(".panel-list").click(function(e){var e=e||window.event,e=e.target||e.srcElement,t=$(e),n=t.parent().index(),r=commander.getCommandList(),o={};function a(e){if(commander.getState(e))return 1;logger.log("向轨道"+(e+1)+"发送的 "+t.attr("class")+" 指令发生未知错误！")}if("button"==e.nodeName.toLowerCase())switch(t.attr("class")){case"create":commander.getState(n)||(shipFactory.create({orbit:n}),commander.setState(n),logger.log(n+1+"号飞船创建成功"));break;case"launch":a(n)&&commander.sendMessage(n,r.launch);break;case"stop":a(n)&&commander.sendMessage(n,r.stop);break;case"rate":a(n)&&((o=Object.create(r.rate)).flySpeed=parseInt(t.parent().children("input").val()),commander.sendMessage(n,o));break;case"destroy":a(n)&&commander.sendMessage(n,r.destroy)&&commander.removeState(n)}});
//# sourceMappingURL=main.min.js.map
