var logger=function(e,t,n){function r(e){e&&setTimeout(function(){$(".logger-list").last().append('<li "class="logger-list-item"> - '+new Date+": "+e+" - </li>")},500)}return{log:r}}(window,document),mediator=function(e,t,n){var r={},o=-1,a=function(e,t){var n;return r[e]||(r[e]=[]),n=(++o).toString(),r[e].push({context:t,orbit:e,token:n,callback:t.transferSys.messageReceiver}),n},s=function(e){var t,n;if(!r[e])return!1;t=Array.prototype.slice.call(arguments),n=r[e].length;for(var o=0;n>o;o++){var a=r[e][o];a.callback.apply(a.context,t)}return this},c=function(e){for(var t in r)if(r[t])for(var n=0,o=r[t].length;o>n;n++)if(r[t][n].token===e)return r[t].splice(n,1),e;return!1};return{subscribe:a,publish:s,unsubscribe:c}}(window,document),shipFactory=function(e,t,n){function r(e){var t={orbit:e.orbit||0,isFly:!1,isGone:!1,leftEnergy:100,flySpeed:e.flySpeed||1,restoreSpeed:e.restoreSpeed||5,consumeSpeed:e.consumeSpeed||3,angle:0,launchId:0,stopId:0,driveSys:{launch:function(){t.leftEnergy>0&&(t.isFly=!0,clearInterval(t.launchId),clearInterval(t.stopId),t.launchId=setInterval(function(){t.driveSys.fly(),t.energySys.consume()},200))},stop:function(){t.isFly=!1,clearInterval(t.launchId),clearInterval(t.stopId),t.stopId=setInterval(function(){t.energySys.restore()},200)},fly:function(){t.isFly&&(t.angle+=t.flySpeed),t.angle%=360,$("#ship"+t.orbit).css("transform","rotate("+t.angle+"deg)")}},energySys:{restore:function(){t.isFly||(t.leftEnergy+=t.restoreSpeed),t.leftEnergy>100&&(t.leftEnergy=100),$("#ship"+t.orbit).text(t.leftEnergy+"%")},consume:function(){t.isFly&&(t.leftEnergy-=t.consumeSpeed),t.leftEnergy<=0&&(t.isFly=!1,t.leftEnergy=0,clearInterval(t.launchId),clearInterval(t.stopId),t.stopId=setInterval(function(){t.energySys.restore()},200)),$("#ship"+t.orbit).text(t.leftEnergy+"%")}},destroySys:{destroy:function(){t.isGone=!0,setTimeout(function(){$("#ship"+t.orbit).remove()},200)}},transferSys:{messageReceiver:function(e,n){switch(n.command){case"launch":t.driveSys.launch();break;case"stop":t.driveSys.stop();break;case"rate":t.flySpeed=n.flySpeed;break;case"destroy":t.destroySys.destroy()}}}};return t}function o(e){if("object"==typeof e){var t=new r(e);return mediator.subscribe(t.orbit,t),setTimeout(function(){$(".space").append('<button class="spaceship" type="button" id="ship'+t.orbit+'">100%</button>')},200),t}}return{create:o}}(window,document),commander=function(e,t,n){function r(){return i}function o(e){l[e]=!0}function a(e){l[e]=!1}function s(e){return l[e]}function c(e,t){return Math.random()<=.3?(logger.log("向轨道"+(e+1)+"发送的 "+t.command+" 指令发生未知错误！"),!1):(logger.log("向轨道"+(e+1)+"成功发送 "+t.command+" 指令！"),mediator.publish(e,t),!0)}var i={launch:{id:1,command:"launch"},stop:{id:2,command:"stop"},rate:{id:3,command:"rate",flySpeed:1},destroy:{id:4,command:"destroy"}},l=[!1,!1,!1,!1];return{getCommandList:r,setState:o,removeState:a,getState:s,sendMessage:c}}(window,document,void 0);!function(e,t,n){$(".panel-list").click(function(e){function t(e){return commander.getState(e)?!0:(logger.log("向轨道"+(e+1)+"发送的 "+o.attr("class")+" 指令发生未知错误！"),!1)}var n=e||window.event,r=n.target||n.srcElement,o=$(r),a=o.parent().index(),s=commander.getCommandList(),c={},i=!1;if("button"==r.nodeName.toLowerCase())switch(o.attr("class")){case"create":commander.getState(a)||(shipFactory.create({orbit:a}),commander.setState(a),logger.log(a+1+"号飞船创建成功"));break;case"launch":t(a)&&commander.sendMessage(a,s.launch);break;case"stop":t(a)&&commander.sendMessage(a,s.stop);break;case"rate":t(a)&&(c=Object.create(s.rate),c.flySpeed=parseInt(o.parent().children("input").val()),commander.sendMessage(a,c));break;case"destroy":t(a)&&(i=commander.sendMessage(a,s.destroy),i&&commander.removeState(a))}})}(window,document);
//# sourceMappingURL=main.min.js.map
