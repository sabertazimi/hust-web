{"version":3,"sources":["main.min.js"],"names":["logger","global","doc","undef","_log","msg","setTimeout","$","last","append","Date","log","window","document","mediator","orbits","subUid","subscribe","orbit","obj","token","toString","push","context","callback","transferSys","messageReceiver","publish","args","len","Array","prototype","slice","call","arguments","length","i","subscription","apply","this","unsubscribe","m","j","splice","shipFactory","spaceship","options","isFly","isGone","leftEnergy","flySpeed","restoreSpeed","consumeSpeed","angle","launchId","stopId","driveSys","launch","clearInterval","setInterval","fly","energySys","consume","stop","restore","css","text","destroySys","destroy","remove","command","_create","create","commander","_getList","commandList","_set","index","existShip","_remove","_get","_send","Math","random","id","rate","getCommandList","setState","removeState","getState","sendMessage","undefined","click","e","stateCheck","$target","attr","event","target","srcElement","parent","cmdList","rateCmd","msgState","nodeName","toLowerCase","Object","parseInt","children","val"],"mappings":"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","file":"main.min.js","sourcesContent":["/*\n    logger - 向右侧信息台输出信息\n    pattern - singleton\n */\nvar logger = (function(global, doc, undef) {\n    function _log(msg) {\n        if (msg) {\n            setTimeout(function(){\n                $('.logger-list').last().append('<li \"class=\"logger-list-item\"> - ' + new Date() + ': ' + msg + ' - </li>');\n            }, 500);\n        }\n    }\n    return {\n        log: _log\n    };\n}(window, document));\n\n/**\n * mediator - 中介者，负责传送指令\n */\nvar mediator = (function ( global, doc, undef ) {\n    var orbits = {},\n        subUid = -1,\n\n        subscribe = function (orbit, obj ) {\n            var token;\n\n            if (!orbits[orbit]) {\n                orbits[orbit] = [];\n            }\n\n    \t\t// add observer to observerlist(orbits)\n            token = (++subUid).toString();\n            orbits[orbit].push({\n                context: obj,\n                orbit: orbit,\n                token: token,\n                callback: obj.transferSys.messageReceiver\n            });\n\n            return token;\n        },\n        publish = function (orbit) {\n            var args,\n                len;\n\n            // undefined check\n            if (!orbits[orbit]) {\n                return false;\n            }\n\n            args = Array.prototype.slice.call(arguments);\n            len = orbits[orbit].length;\n\n            for (var i = 0;i < len;i++) {\n                var subscription = orbits[orbit][i];\n                subscription.callback.apply(subscription.context, args);\n            }\n\n            // chain pattern\n            return this;\n        },\n        unsubscribe = function (token) {\n            for (var m in orbits) {\n                if (orbits[m]) {\n                    for (var i = 0, j = orbits[m].length; i < j; i++) {\n                        if (orbits[m][i].token === token) {\n                            orbits[m].splice(i, 1);\n                            return token;\n                        }\n                    }\n                }\n            }\n            return false;\n        };\n\n        return {\n            subscribe: subscribe,\n            publish: publish,\n            unsubscribe: unsubscribe,\n        };\n}(window, document));\n\n/**\n *  spaceship  factory\n */\nvar shipFactory = (function (global, doc, undef) {\n\n    // spaceship prototype\n    function spaceship(options) {\n        var obj = {\n            orbit: options.orbit || 0,\n            isFly: false,\n            isGone: false,\n            leftEnergy: 100,\n            flySpeed: options.flySpeed || 1,\n            restoreSpeed: options.restoreSpeed || 5,\n            consumeSpeed: options.consumeSpeed || 3,\n            angle: 0,\n            // interval animation id\n            launchId: 0,\n            stopId: 0,\n\n            driveSys: {\n                launch: function () {\n                    if (obj.leftEnergy > 0) {\n                        obj.isFly = true;\n                        clearInterval(obj.launchId);\n                        clearInterval(obj.stopId);\n                        obj.launchId = setInterval(function(){\n                            obj.driveSys.fly();\n                            obj.energySys.consume();\n                        }, 200);\n                    }\n                },\n                stop: function () {\n                    obj.isFly = false;\n                    clearInterval(obj.launchId);\n                    clearInterval(obj.stopId);\n                    obj.stopId = setInterval(function(){\n                        obj.energySys.restore();\n                    }, 200);\n                },\n                fly: function () {\n                    if (obj.isFly) {\n                        obj.angle += obj.flySpeed;\n                    }\n                    obj.angle %= 360;\n                    $('#ship' + obj.orbit).css('transform', 'rotate(' + obj.angle + 'deg)');\n                }\n            },\n\n            energySys: {\n                restore: function () {\n                    if (!obj.isFly) {\n                        obj.leftEnergy += obj.restoreSpeed;\n                    }\n                    if (obj.leftEnergy > 100) {\n                        obj.leftEnergy = 100;\n                    }\n                    $('#ship' + obj.orbit).text(obj.leftEnergy + '%');\n                },\n                consume: function () {\n                    if (obj.isFly) {\n                        obj.leftEnergy -= obj.consumeSpeed;\n                    }\n                    if (obj.leftEnergy <= 0) {\n                        obj.isFly = false;\n                        obj.leftEnergy = 0;\n                        clearInterval(obj.launchId);\n                        clearInterval(obj.stopId);\n                        obj.stopId = setInterval(function(){\n                            obj.energySys.restore();\n                        }, 200);\n                    }\n                    $('#ship' + obj.orbit).text(obj.leftEnergy + '%');\n                }\n            },\n\n            destroySys: {\n                destroy: function () {\n                    obj.isGone = true;\n                    setTimeout(function () {\n                        $('#ship' + obj.orbit).remove();\n                    }, 200);\n                }\n            },\n\n            transferSys: {\n                messageReceiver: function (orbit, msg) {\n                    switch (msg.command) {\n                        case 'launch':\n                            obj.driveSys.launch();\n                            break;\n                        case 'stop':\n                            obj.driveSys.stop();\n                            break;\n                        case 'rate':\n                            obj.flySpeed = msg.flySpeed;\n                            break;\n                        case 'destroy':\n                            obj.destroySys.destroy();\n                            break;\n                    }\n                }\n            }\n        };\n\n        return obj;\n    }\n\n    function _create(options) {\n        if (typeof options === 'object') {\n            var obj = new spaceship(options);\n            //  开始监测指挥官发来的信号\n            mediator.subscribe(obj.orbit, obj);\n            setTimeout(function () {\n                $('.space').append('<button class=\"spaceship\" type=\"button\" id=\"ship' + obj.orbit + '\">100%</button>');\n            }, 200);\n            return obj;\n        }\n    }\n\n    return {\n        create: _create\n    };\n\n}(window, document));\n\n/**\n * commander - 指挥官\n */\nvar commander =  (function (global, doc, undef) {\n    var commandList = {\n        launch: {\n            id: 1,\n            command: 'launch'\n        },\n        stop: {\n            id: 2,\n            command: 'stop'\n        },\n        rate: {\n            id: 3,\n            command: 'rate',\n            flySpeed: 1,\n        },\n        destroy: {\n            id: 4,\n            command: 'destroy'\n        }\n    },\n    existShip = [false, false, false ,false];\n\n    function _getList() {\n        return commandList;\n    }\n\n    function _set(index) {\n        existShip[index] = true;\n    }\n\n    function _remove(index) {\n        existShip[index] = false;\n    }\n\n    function _get(index) {\n        return existShip[index];\n    }\n\n    function _send(orbit, msg) {\n        if(Math.random() <= 0.3) {\n            logger.log(\"向轨道\" + (orbit + 1) + \"发送的 \" + msg.command + \" 指令发生未知错误！\");\n            return false;\n        } else {\n            logger.log(\"向轨道\" + (orbit + 1) + \"成功发送 \" + msg.command + \" 指令！\");\n            mediator.publish(orbit, msg);\n            return true;\n        }\n    }\n\n    return {\n        getCommandList: _getList,\n        setState: _set,\n        removeState: _remove,\n        getState: _get,\n        sendMessage: _send\n    };\n}(window, document, undefined));\n\n(function (global, doc, undef) {\n    // 利用事件委托绑定回调\n    $('.panel-list').click(function (e) {\n        var event = e || window.event,\n            target = event.target || event.srcElement,\n            $target = $(target),\n            index = $target.parent().index(),\n            cmdList = commander.getCommandList(),\n            rateCmd = {},\n            msgState = false;\n\n        function stateCheck(index) {\n            if (!commander.getState(index)) {\n                logger.log(\"向轨道\" + (index + 1) + \"发送的 \" + $target.attr('class') + \" 指令发生未知错误！\");\n                return false;\n            } else {\n                return true;\n            }\n        }\n\n        if (target.nodeName.toLowerCase() == \"button\") {\n            switch ($target.attr('class')) {\n                case 'create':\n                    if (!commander.getState(index)) {\n                        shipFactory.create({orbit: index});\n                        commander.setState(index);\n                        logger.log((index + 1) + '号飞船创建成功');\n                    }\n                    break;\n                case 'launch':\n                    if (stateCheck(index)) {\n                        commander.sendMessage(index, cmdList.launch);\n                    }\n                    break;\n                case 'stop':\n                    if (stateCheck(index)) {\n                        commander.sendMessage(index, cmdList.stop);\n                    }\n                    break;\n                case 'rate':\n                    if (stateCheck(index)) {\n                        rateCmd = Object.create(cmdList.rate);\n                        rateCmd.flySpeed = parseInt($target.parent().children('input').val());\n                        commander.sendMessage(index, rateCmd);\n                    }\n                    break;\n                case 'destroy':\n                    if (stateCheck(index)) {\n                        msgState = commander.sendMessage(index, cmdList.destroy);\n                        if (msgState) {\n                            commander.removeState(index);\n                        }\n                    }\n                    break;\n            }\n        }\n    });\n}(window, document));\n"],"sourceRoot":"/source/"}